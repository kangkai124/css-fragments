<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>3D map</title>
  <link rel="stylesheet" href="../common.css">
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="../node_modules/echarts/dist/echarts.js"></script>
  <script src="../node_modules/echarts-gl/dist/echarts-gl.js"></script>
  <script type="text/javascript" src="./china.js"></script>
  <style>
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
</body>

<script type="text/javascript">
  var myChart = echarts.init(document.getElementById('map'))

  var uploadedDataURL = "./flights.json";

  myChart.showLoading();

  $.getJSON(uploadedDataURL, function(data) {

    myChart.hideLoading();

    function getAirportCoord(idx) {
      return [data.airports[idx][3], data.airports[idx][4]];
    }
    var routes = data.routes.map(function(airline) {
      return [
        getAirportCoord(airline[1]),
        getAirportCoord(airline[2])
      ];
    });
    console.log(routes)

    myChart.setOption({
      geo3D: {
        map: 'china',
        shading: 'realistic',
        silent: true,
        environment: '#333',
        realisticMaterial: {
          roughness: 0.8,
          metalness: 0
        },
        postEffect: {
          enable: true
        },
        groundPlane: {
          show: false
        },
        light: {
          main: {
            intensity: 1,
            alpha: 30
          },
          ambient: {
            intensity: 0
          }
        },
        viewControl: {
          distance: 70,
          alpha: 89,

          panMouseButton: 'left',
          rotateMouseButton: 'right'
        },

        itemStyle: {
          areaColor: '#2ee'
        },

        regionHeight: 0.5
      },
      series: [{
        type: 'lines3D',

        coordinateSystem: 'geo3D',

        effect: {
          show: true,
          trailWidth: 1,
          trailOpacity: 0.5,
          trailLength: 0.2,
          constantSpeed: 5
        },

        blendMode: 'lighter',

        lineStyle: {
          width: 1,
          opacity: 0.1
        },

        data: routes
      }]
    });

    window.addEventListener('keydown', function() {
      myChart.dispatchAction({
        type: 'lines3DToggleEffect',
        seriesIndex: 0
      });
    });
  });
</script>

</html>
